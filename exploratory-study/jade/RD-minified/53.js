"use strict";var fs=require("fs"),path=require("path"),lex=require("pug-lexer"),stripComments=require("pug-strip-comments"),parse=require("pug-parser"),load=require("pug-loader"),filters=require("pug-filters"),link=require("pug-linker"),generateCode=require("pug-code-gen"),runtime=require("pug-runtime"),runtimeWrap=require("pug-runtime/wrap");function compileBody(e,r){var i={};i[r.filename]=e;var n=[],t=load.string(e,r.filename,{lex:lex,parse:function(e,r){return e=stripComments(e,{filename:r}),parse(e,r)},resolve:function(e,i){if("/"!==(e=e.trim())[0]&&!i)throw new Error('the "filename" option is required to use includes and extends with "relative" paths');if("/"===e[0]&&!r.basedir)throw new Error('the "basedir" option is required to use includes and extends with "absolute" paths');return e=path.join("/"===e[0]?r.basedir:path.dirname(i),e),-1===path.basename(e).indexOf(".")&&(e+=".pug"),e},read:function(e){n.push(e);var r=fs.readFileSync(e,"utf8");return i[e]=r,r}});t=filters.handleFilters(t,exports.filters),t=link(t);var o=generateCode(t,{pretty:r.pretty,compileDebug:r.compileDebug,doctype:r.doctype,inlineRuntimeFunctions:r.inlineRuntimeFunctions,globals:r.globals,self:r.self,includeSources:!!r.includeSources&&i,templateName:r.templateName});return r.debug,{body:o,dependencies:n}}function handleTemplateCache(e,r){var i=e.filename;if(e.cache&&exports.cache[i])return exports.cache[i];void 0===r&&(r=fs.readFileSync(e.filename,"utf8"));var n=exports.compile(r,e);return e.cache&&(exports.cache[i]=n),n}exports.runtime=runtime,exports.cache={},exports.filters={},exports.compile=function(e,r){r=r||{};var i=compileBody(e=String(e),{compileDebug:!1!==r.compileDebug,filename:r.filename,basedir:r.basedir,pretty:r.pretty,doctype:r.doctype,inlineRuntimeFunctions:r.inlineRuntimeFunctions,globals:r.globals,self:r.self,includeSources:!0===r.compileDebug,debug:r.debug,templateName:"template"}),n=r.inlineRuntimeFunctions?new Function("",i.body+";return template;")():runtimeWrap(i.body);return n.dependencies=i.dependencies,n},exports.compileClientWithDependenciesTracked=function(e,r){r=r||{};var i=compileBody(e=String(e),{compileDebug:r.compileDebug,filename:r.filename,basedir:r.basedir,pretty:r.pretty,doctype:r.doctype,inlineRuntimeFunctions:!1!==r.inlineRuntimeFunctions,globals:r.globals,self:r.self,includeSources:r.compileDebug,debug:r.debug,templateName:r.name||"template"});return{body:i.body,dependencies:i.dependencies}},exports.compileClient=function(e,r){return exports.compileClientWithDependenciesTracked(e,r).body},exports.compileFile=function(e,r){return(r=r||{}).filename=e,handleTemplateCache(r)},exports.render=function(e,r,i){if("function"==typeof r&&(i=r,r=void 0),"function"==typeof i)try{exports.render(e,r)}catch(e){return i(e)}if((r=r||{}).cache&&!r.filename)throw new Error('the "filename" option is required for caching');return handleTemplateCache(r,e)(r)},exports.renderFile=function(e,r,i){if("function"==typeof r&&(i=r,r=void 0),"function"==typeof i){var n;try{n=exports.renderFile(e,r)}catch(e){return i(e)}return i(null,n)}return(r=r||{}).filename=e,handleTemplateCache(r)(r)},exports.compileFileClient=function(e,r){if((r=r||{}).filename=e,r.cache&&exports.cache[void 0])return exports.cache[void 0];var i=fs.readFileSync(r.filename,"utf8"),n=exports.compileClient(i,r);return r.cache&&(exports.cache[void 0]=n),n},exports.__express=function(e,r,i){void 0==r.compileDebug&&"production"===process.env.NODE_ENV&&(r.compileDebug=!1)};