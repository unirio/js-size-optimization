"use strict";var fs=require("fs"),path=require("path"),lex=require("pug-lexer"),stripComments=require("pug-strip-comments"),parse=require("pug-parser"),load=require("pug-loader"),filters=require("pug-filters"),link=require("pug-linker"),generateCode=require("pug-code-gen"),runtime=require("pug-runtime"),runtimeWrap=require("pug-runtime/wrap");function compileBody(e,n){var r={};r[n.filename]=e;var t=[],i=load.string(e,n.filename,{lex:lex,parse:function(e,n){return e=stripComments(e,{filename:n}),parse(e,n)},resolve:function(e,r){if("/"!==(e=e.trim())[0]&&!r)throw new Error('the "filename" option is required to use includes and extends with "relative" paths');if("/"===e[0]&&!n.basedir)throw new Error('the "basedir" option is required to use includes and extends with "absolute" paths');return e=path.join("/"===e[0]?n.basedir:path.dirname(r),e),-1===path.basename(e).indexOf(".")&&(e+=".pug"),e},read:function(e){t.push(e);var n=fs.readFileSync(e,"utf8");return r[e]=n,n}});i=filters.handleFilters(i,exports.filters),i=link(i);var o=generateCode(i,{pretty:n.pretty,compileDebug:n.compileDebug,doctype:n.doctype,inlineRuntimeFunctions:n.inlineRuntimeFunctions,globals:n.globals,self:n.self,includeSources:!!n.includeSources&&r,templateName:n.templateName});return n.debug,{body:o,dependencies:t}}function handleTemplateCache(e,n){var r=e.filename;if(e.cache&&exports.cache[r])return exports.cache[r];void 0===n&&(n=fs.readFileSync(e.filename,"utf8"));var t=exports.compile(n,e);return e.cache&&(exports.cache[r]=t),t}exports.runtime=runtime,exports.cache={},exports.filters={},exports.compile=function(e,n){n=n||{};var r=compileBody(e=String(e),{compileDebug:!1!==n.compileDebug,filename:n.filename,basedir:n.basedir,pretty:n.pretty,doctype:n.doctype,inlineRuntimeFunctions:n.inlineRuntimeFunctions,globals:n.globals,self:n.self,includeSources:!0===n.compileDebug,debug:n.debug,templateName:"template"}),t=n.inlineRuntimeFunctions?new Function("",r.body+";return template;")():runtimeWrap(r.body);return t.dependencies=r.dependencies,t},exports.compileClientWithDependenciesTracked=function(e,n){n=n||{};var r=compileBody(e=String(e),{compileDebug:n.compileDebug,filename:n.filename,basedir:n.basedir,pretty:n.pretty,doctype:n.doctype,inlineRuntimeFunctions:!1!==n.inlineRuntimeFunctions,globals:n.globals,self:n.self,includeSources:n.compileDebug,debug:n.debug,templateName:n.name||"template"});return{body:r.body,dependencies:r.dependencies}},exports.compileClient=function(e,n){return exports.compileClientWithDependenciesTracked(e,n).body},exports.compileFile=function(e,n){return(n=n||{}).filename=e,handleTemplateCache(n)},exports.render=function(e,n,r){if("function"==typeof n&&(r=n,n=void 0),"function"==typeof r)try{exports.render(e,n)}catch(e){return}return(n=n||{}).cache&&n.filename,handleTemplateCache(n,e)(n)},exports.renderFile=function(e,n,r){if("function"==typeof n&&(r=n,n=void 0),"function"==typeof r){var t;try{t=exports.renderFile(e,n)}catch(e){return r(e)}return r(null,t)}return(n=n||{}).filename=e,handleTemplateCache(n)(n)},exports.compileFileClient=function(e,n){var r=e+":client";if((n=n||{}).filename=e,n.cache&&exports.cache[r])return exports.cache[r];var t=fs.readFileSync(n.filename,"utf8"),i=exports.compileClient(t,n);return n.cache&&(exports.cache[r]=i),i},exports.__express=function(e,n,r){void 0==n.compileDebug&&"production"===process.env.NODE_ENV&&(n.compileDebug=!1)};